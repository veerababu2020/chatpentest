import openai
import subprocess
import pyfiglet
pyfiglet_design = pyfiglet.figlet_format("chatpentest")
print(pyfiglet_design)

# Your OpenAI API key
openai.api_key = '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'

def generate_response(prompt):
    response = openai.Completion.create(
        engine="text-davinci-002",
        prompt=prompt,
        max_tokens=100
    )
    return response.choices[0].text.strip()

def main():
    print("Welcome to the ChatPentest Tool")
    print("Type 'exit' to quit for main terminal.")

    while True:
        user_input = input("Enter your text for generate payload: ")

        if user_input.lower() == 'exit':
            break

        # Use OpenAI to generate payload command
        prompt = user_input + " payload command is "
        payload_command = generate_response(prompt)

        print("Generated payload command:")
        print(payload_command)

        # Extract the output file name
        output_file = payload_command.split(">")[-1].strip()

        # Remove the output redirection from the command
        cmd = payload_command.replace(f" > {output_file}", "").strip()

        # Execute the command and redirect output to the specified file
        with open(output_file, "wb") as outfile:
            subprocess.run(cmd, shell=True, stdout=outfile, stderr=subprocess.PIPE)

        print(f"Payload saved as {output_file}")

if __name__ == "__main__":
    main()
